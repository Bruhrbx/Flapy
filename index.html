<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Flapy Razka</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#3aaeff;color:white;overflow:hidden}

/* MENU */
#menu{
 position:fixed; inset:0;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 gap:14px;
 background:#3aaeff;
 z-index:10;
}
#menu h1{font-size:48px}
#lastScore{font-size:18px;opacity:.9}

input,select,button{
 font-size:18px;
 padding:12px 24px;
 border-radius:12px;
 border:none;
}

button{background:#2ecc71;color:white;cursor:pointer}

/* MODE + START */
.mode-start{
 display:flex;
 gap:12px;
 align-items:center;
}

/* LEADERBOARD */
#leaderboard{
 margin-top:10px;
 background:rgba(0,0,0,.3);
 padding:14px 22px;
 border-radius:14px;
 width:300px;
}
#leaderboard h2{text-align:center;margin-bottom:8px}
#leaderboard li{
 display:flex;
 justify-content:space-between;
 padding:4px 0;
}

/* SCORE */
#score{
 position:fixed;
 top:20px;
 left:50%;
 transform:translateX(-50%);
 font-size:36px;
 text-shadow:2px 2px 4px #000;
 display:none;
 z-index:5;
}

/* PAUSE */
#pauseBtn{
 position:fixed;
 top:20px;
 right:20px;
 font-size:24px;
 background:rgba(0,0,0,.4);
 color:white;
 padding:10px 14px;
 border-radius:12px;
 display:none;
 z-index:6;
}
#pauseText{
 position:fixed; inset:0;
 display:none;
 justify-content:center;
 align-items:center;
 flex-direction:column;
 gap:20px;
 font-size:42px;
 background:rgba(0,0,0,.45);
 z-index:15;
}

/* GAME */
#game{position:fixed;inset:0;display:none;overflow:hidden}
#bird{
 position:absolute;
 width:40px;
 height:40px;
 left:20%;
 transform-origin:center;
 transition:transform .1s linear;
}

/* PIPE (FIXED) */
.pipe{
 position:absolute;
 width:70px;                 /* lebih lega di HP */
 background:#2ecc71;
 transition:left .016s linear; /* smooth */
}
.pipe.top{top:0}
.pipe.bottom{bottom:0}

/* GAME OVER */
#gameover{
 position:fixed; inset:0;
 display:none;
 background:black;
 z-index:20;
}
#gameover video{
 width:100%;
 height:100%;
 object-fit:cover;
}
</style>
</head>

<body>

<div id="menu">
 <h1>üê¶ Flapy Razka</h1>
 <div id="lastScore">Last Score: 0</div>

 <input id="username" placeholder="Masukkan Username">

 <div class="mode-start">
  <select id="mode">
   <option value="easy">Easy</option>
   <option value="normal" selected>Normal</option>
   <option value="hard">Hard</option>
  </select>
  <button id="startBtn">START</button>
 </div>

 <div id="leaderboard">
  <h2>üèÜ Live Score</h2>
  <ul id="scoreList"></ul>
 </div>
</div>

<div id="score">0</div>
<button id="pauseBtn">‚è∏</button>

<div id="pauseText">
 ‚è∏ PAUSED
 <button id="resumeBtn">‚ñ∂ RESUME</button>
</div>

<div id="game">
 <img id="bird" src="p.png">
</div>

<div id="gameover">
 <video id="overVideo" src="over.mp4"></video>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
 apiKey:"AIzaSyA59R5odWFkcOqnrZTx5MEg44AEyQGfYf0",
 authDomain:"flapy-7dc9e.firebaseapp.com",
 databaseURL:"https://flapy-7dc9e-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"flapy-7dc9e",
 storageBucket:"flapy-7dc9e.firebasestorage.app",
 messagingSenderId:"896361737780",
 appId:"1:896361737780:web:9df3225d6da05aa9afa461"
});
const db=firebase.database();

/* ELEMENT */
const menu=document.getElementById("menu");
const game=document.getElementById("game");
const bird=document.getElementById("bird");
const scoreText=document.getElementById("score");
const pauseBtn=document.getElementById("pauseBtn");
const pauseText=document.getElementById("pauseText");
const resumeBtn=document.getElementById("resumeBtn");
const lastScoreText=document.getElementById("lastScore");
const scoreList=document.getElementById("scoreList");
const usernameInput=document.getElementById("username");
const startBtn=document.getElementById("startBtn");
const mode=document.getElementById("mode");
const gameover=document.getElementById("gameover");
const overVideo=document.getElementById("overVideo");

/* GAME VAR */
let birdY,velocity,gravity,lift,pipeSpeed;
let pipes=[],score=0,running=false,paused=false;
let playerName="";
let pipeDistance=0;

/* START */
startBtn.onclick=()=>{
 if(!usernameInput.value.trim()) return alert("Masukkan username!");
 playerName=usernameInput.value.trim();

 if(mode.value==="easy"){gravity=.4;lift=-6;pipeSpeed=2.5}
 if(mode.value==="normal"){gravity=.45;lift=-6.5;pipeSpeed=3}
 if(mode.value==="hard"){gravity=.5;lift=-7;pipeSpeed=3.5}

 menu.style.display="none";
 game.style.display="block";
 scoreText.style.display="block";
 pauseBtn.style.display="block";

 birdY=innerHeight/2;
 velocity=0;score=0;
 pipes.forEach(p=>{p.top.remove();p.bottom.remove()});
 pipes=[];
 pipeDistance=0;
 running=true;paused=false;
 scoreText.innerText=0;
 loop();
};

/* PIPE ‚Äì JARAK TERKONTROL */
function createPipe(){
 const gap=240;
 const minTop=60;
 const maxTop=innerHeight-gap-100;
 const topH=Math.random()*(maxTop-minTop)+minTop;

 const top=document.createElement("div");
 const bottom=document.createElement("div");

 top.className="pipe top";
 bottom.className="pipe bottom";

 top.style.height=topH+"px";
 bottom.style.height=(innerHeight-topH-gap)+"px";
 top.style.left=bottom.style.left=innerWidth+"px";

 game.append(top,bottom);
 pipes.push({top,bottom,x:innerWidth,passed:false});
}

/* LOOP */
function loop(){
 if(!running){return}
 if(paused){requestAnimationFrame(loop);return}

 velocity+=gravity;
 birdY+=velocity;
 bird.style.top=birdY+"px";
 bird.style.transform=`rotate(${Math.max(-25,velocity*8)}deg)`;

 if(birdY<0||birdY+24>innerHeight) return gameOver();

 pipeDistance+=pipeSpeed;
 if(pipeDistance>280){   /* JARAK ANTAR PIPA */
  createPipe();
  pipeDistance=0;
 }

 pipes.forEach(p=>{
  p.x-=pipeSpeed;
  p.top.style.left=p.bottom.style.left=p.x+"px";

  if(!p.passed&&p.x<innerWidth*.2){
   p.passed=true;
   score++;
   scoreText.innerText=score;
  }

  const b=bird.getBoundingClientRect();
  if(b.left<p.x+70&&b.right>p.x&&(b.top<p.top.offsetHeight||b.bottom>innerHeight-p.bottom.offsetHeight))
   gameOver();
 });

 pipes=pipes.filter(p=>p.x>-100);
 requestAnimationFrame(loop);
}

/* CONTROL */
addEventListener("click",()=>running&&!paused&&(velocity=lift));
addEventListener("touchstart",()=>running&&!paused&&(velocity=lift),{passive:true});

/* PAUSE */
pauseBtn.onclick=()=>{paused=true;pauseText.style.display="flex"};
resumeBtn.onclick=()=>{paused=false;pauseText.style.display="none"};

/* GAME OVER */
function gameOver(){
 running=false;
 lastScoreText.innerText="Last Score: "+score;

 db.ref("scores/"+playerName).set({
  username:playerName,
  score, time:Date.now()
 });

 game.style.display="none";
 scoreText.style.display="none";
 pauseBtn.style.display="none";
 pauseText.style.display="none";
 gameover.style.display="block";
 overVideo.currentTime=0;
 overVideo.play();
}

overVideo.onended=()=>{
 gameover.style.display="none";
 menu.style.display="flex";
};

/* LEADERBOARD */
db.ref("scores").orderByChild("score").limitToLast(5).on("value",snap=>{
 scoreList.innerHTML="";
 const arr=[];
 snap.forEach(s=>arr.push(s.val()));
 arr.reverse().forEach((d,i)=>{
  scoreList.innerHTML+=`<li><span>#${i+1} ${d.username}</span><span>${d.score}</span></li>`;
 });
});
</script>

</body>
</html>
